using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Net;
using System.IO;
using System.Web.Script.Serialization;

public partial class Login_Versao01_Login : System.Web.UI.Page
{
    OperJson operJson = new OperJson();

    protected void Page_Load(object sender, EventArgs e)
    {

    }

    public void btnLogin_Click(object sender, EventArgs e)
   {
      string json = "{\"email\":\"" + txtUsuario.Text + "\", \"password\":\"" + txtSenha.Text + "\" }";
      string retorno = operJson.SendJson(json, "http://192.241.132.106:8080/libraryWS/user", "PUT");
      if (retorno.Substring(12, 28).Equals("Login realizado com sucesso!"))
      {
          string[] retorno2 = retorno.Split(',');
          string[] admin = retorno2[2].Split(':');
          if (admin.Count() > 0 && admin[1].Equals("\"true\""))
          {
              Session["admin"] = "true";
          }
          else
          {
              Session["admin"] = "false";
          }
          Session["usuario"] = txtUsuario.Text;
          Response.Redirect("../../Livro/Versao01/Livros.aspx");
      }

      else
      {
          txtSenha.Text = null;
          txtUsuario.Text = null;
          divErro.Visible = true;
          lblErro.Text = "Login ou senha inv√°lidos";
      }
   }
}
